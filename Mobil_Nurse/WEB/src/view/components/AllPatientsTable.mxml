<?xml version="1.0" encoding="utf-8"?>
<s:View xmlns:fx="http://ns.adobe.com/mxml/2009"
		xmlns:s="library://ns.adobe.com/flex/spark"
		xmlns:services="services.*"
		initialize="onInitialization(event)" title="Select a Patient">
	
	<fx:Script>
		<![CDATA[
			import control.events.GetPatientEvent;
			
			import model.vo.BasicPatientVO;
			
			import mx.collections.ArrayCollection;
			import mx.events.FlexEvent;
			
			public static const NAME:String = 'AllPatientsTable';
			public static const VIEW_EMPLOYEE_DATA:String = NAME + "ViewEmployeeData";
			public static const VIEW_EMPLOYEE_DETAILS:String = NAME + "ViewEmployeeDetails";
			public static const GET_FULL_PATIENT:String = NAME + "GetFullPatient";
			public var coll:ArrayCollection = new ArrayCollection();
			
			public function onInitialization(event:FlexEvent):void {
				this.id = NAME;
			}

			public function fireMVCLog():void {
				dispatchEvent( new Event( VIEW_EMPLOYEE_DATA ) );
				trace("fireMVCLOG");
			}

			/** PureMVC PART PureMVC Part PureMVC PART **/
			
			public function logoutView():void {
				navigator.popView();
			}
			
			protected function dataGrid_clickHandler(event:MouseEvent):void
			{
				if(dataGrid.selectedItem != null)
				{
					dispatchEvent( new Event( VIEW_EMPLOYEE_DETAILS, event.target ) );
				}
			}
			
			public function detailView(event:Event):void{
				var b:BasicPatientVO = event.currentTarget.dataGrid.selectedItem as BasicPatientVO;
				dispatchEvent( new GetPatientEvent( GET_FULL_PATIENT , b.id ) );
				
				//var patient:Patient = event.currentTarget.dataGrid.selectedItem as Patient;
				//navigator.pushView(PatientSelected, patient);
			}
			
			public function setDataGrid(ac:ArrayCollection):void{
				coll.list = ac.list;
				coll.refresh();
			}

			private function filterDemo():void{
				/**
				 * Soucrecode from:
				 * http://www.boyzoid.com/blog/index.cfm/2006/10/19/Filtering-Data-in-Flex
				 */								
				coll.filterFunction = filter;
				coll.refresh();
			}
			
			public function filter(item:Object):Boolean{
				/**
				 * Soucrecode from:
				 * http://www.boyzoid.com/blog/index.cfm/2006/10/19/Filtering-Data-in-Flex
				 */		
				var isMatch:Boolean = false
					
				if(Id.selected && item.id == searchString.text || 
					(Firstname.selected && item.firstname.toLowerCase().search(searchString.text.toLowerCase()) != -1) || 
					(Name.selected && item.name.toLowerCase().search(searchString.text.toLowerCase()) != -1)){
					isMatch = true
				}
				return isMatch;
			}

		]]>
	</fx:Script>
	<fx:Declarations>
	</fx:Declarations>
	
	<s:navigationContent>
		<s:Button label="Back" click="fireMVCLog()"/>
	</s:navigationContent>	
	
	<s:DataGrid id="dataGrid" x="1" y="317" width="100%" height="350"
				click="dataGrid_clickHandler(event)" textAlign="left" dataProvider="{coll}">
		<s:columns>
			<s:ArrayList>
				<s:GridColumn dataField="patNr" headerText="Number"/>
				<s:GridColumn dataField="firstname" headerText="Firstname"/>
				<s:GridColumn dataField="name" headerText="Name"/>
				<s:GridColumn dataField="roomNr" headerText="Room"/>
			</s:ArrayList>
		</s:columns>
	</s:DataGrid>
	
	
	<s:Group id="busyIndicatorAllPatients" x="0" y="{dataGrid.y+27}" width="100%"
			 height="{dataGrid.height-27}">
		<s:Rect width="100%" height="100%" alpha="0.2">
			<s:fill><s:SolidColor color="#C0C0C0"/></s:fill>
		</s:Rect>
		<s:BusyIndicator horizontalCenter="0" rotationInterval="50" symbolColor="blue"
						 verticalCenter="0"/>
	</s:Group>
	
	<s:HGroup y="274" right="5">
		<s:Label height="36" text="Search Patients by: " verticalAlign="middle"/>
		<s:RadioButton id="Id"  label="Id"/>
		<s:RadioButton id="Firstname" label="Firstname"/>
		<s:RadioButton id="Name" label="Name" selected="true"/>
		<s:TextInput id="searchString" width="355" change="filterDemo()"/>
	</s:HGroup>

		
	
</s:View>